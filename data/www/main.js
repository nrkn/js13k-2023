(()=>{"use strict";const e=160,t=c;t.width=e,t.height=e;const a=t.getContext("2d"),i=(a=innerWidth,i=innerHeight)=>{const r=a>i?i/e:a/e;t.width=Math.floor(a/r),t.height=Math.floor(i/r)};addEventListener("resize",(()=>i()));const r={startTime:0,lastTime:0,elapsedTime:0,deltaTime:0},n={sky:{x:0,y:0},mountain:{x:0,y:0},ground:{x:0,y:0}},o=[],g={frame:0,direction:1,speed:0,acceleration:0,x:0,y:0},m=new Image,h=[],d={skyImage:m,mountainImage:m,groundImage:m,treeImage:m,girlIdleFrames:h,girlWalkFrames:h},s=e=>{"ArrowLeft"===e.key?(g.direction=-1,g.acceleration=.5):"ArrowRight"===e.key&&(g.direction=1,g.acceleration=-.5)},l=e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(g.acceleration=0)},w=(e,t)=>{const a=Math.floor(e.width/t),i=e.height,r=[];for(let n=0;n<t;n++){const t=document.createElement("canvas");t.width=a,t.height=i,t.getContext("2d").drawImage(e,n*a,0,a,i,0,0,a,i),r.push(t)}return r},f=e=>new Promise(((t,a)=>{const i=new Image;i.src=e,i.onload=()=>t(i),i.onerror=a})),u=e=>{r.startTime||(r.startTime=e,r.lastTime=e),r.elapsedTime=e-r.startTime,r.deltaTime=e-r.lastTime,r.lastTime=e,(e=>{const a=t.width/2;g.speed+=g.acceleration,g.speed*=.95,Math.abs(g.speed)<.1?g.frame=0:g.frame=Math.floor(r.elapsedTime*Math.abs(g.speed)/500)%d.girlWalkFrames.length,g.x-=g.speed;let i=!1;for(const e of o){if(!e.blocks)continue;let r;if(1===e.type){const t=e.image[e.anim];r=t.frames[t.frame]}else r=e.image;const n=Math.floor(e.x-g.x-r.width/2+a),o=t.height-r.height-d.groundImage.height,m=a+d.girlWalkFrames[g.frame].width/2,h=a-d.girlWalkFrames[g.frame].width/2,s=t.height-d.girlWalkFrames[g.frame].height-d.groundImage.height,l=s+d.girlWalkFrames[g.frame].height,w=n+r.width,f=n,c=o,u=c+r.height;if(i=h<w&&m>f&&s<u&&l>c,i)break}i&&(g.x+=g.speed,g.speed=0)})(),n.sky.x+=.5*g.speed,n.mountain.x+=.8*g.speed,n.ground.x+=1*g.speed,n.sky.x<-d.skyImage.width&&(n.sky.x+=d.skyImage.width),n.sky.x>d.skyImage.width&&(n.sky.x-=d.skyImage.width),n.mountain.x<-d.mountainImage.width&&(n.mountain.x+=d.mountainImage.width),n.mountain.x>d.mountainImage.width&&(n.mountain.x-=d.mountainImage.width),n.ground.x<-d.groundImage.width&&(n.ground.x+=d.groundImage.width),n.ground.x>d.groundImage.width&&(n.ground.x-=d.groundImage.width),(e=>{for(const e of o){if(1!==e.type)continue;const{elapsedTime:t}=r,a=e.image[e.anim],{duration:i,frames:n}=a,o=n.length,g=Math.floor(t/i*o)%o;a.frame=g}})(),(e=>{t.width=t.width;const i=t.width/2,r=t.height/2,m=(e,n,o,g=!1)=>{const m=e.width/-2;let h=e.height/-2,d=Math.floor(n+m+i),s=Math.floor(o+h+r);for(g&&(s=t.height-e.height),a.drawImage(e,d,s);d>0;)d-=e.width,a.drawImage(e,d,s);for(d=Math.floor(n+m+i)+e.width;d<t.width;)a.drawImage(e,d,s),d+=e.width};m(d.skyImage,n.sky.x,n.sky.y),m(d.mountainImage,n.mountain.x,n.mountain.y);for(const e of o){let r;if(1===e.type){const t=e.image[e.anim];r=t.frames[t.frame]}else r=e.image;const n=e.moveSpeed?(1-e.moveSpeed)*g.x:0,o=Math.floor(e.x+n-g.x-r.width/2+i),m=t.height-r.height-d.groundImage.height+e.y;if(o+r.width>0&&o<t.width){a.save(),-1===e.direction?(a.translate(o+r.width/2,m+r.height/2),a.scale(-1,1),a.drawImage(r,-r.width/2,-r.height/2)):a.drawImage(r,o,m),a.restore();const n=i+d.girlWalkFrames[g.frame].width/2,h=i-d.girlWalkFrames[g.frame].width/2,s=t.height-d.girlWalkFrames[g.frame].height-d.groundImage.height,l=s+d.girlWalkFrames[g.frame].height,w=o+r.width,f=o,c=m,u=c+r.height;h<w&&n>f&&s<u&&l>c&&(a.fillStyle="rgba(255, 0, 0, 0.05)",a.fillRect(o,m,r.width,r.height))}}m(d.groundImage,n.ground.x,n.ground.y,!0);const h=d.girlWalkFrames[g.frame].width/-2,s=t.height-d.girlWalkFrames[g.frame].height-d.groundImage.height;a.save(),-1===g.direction&&(a.translate(2*i,0),a.scale(g.direction,1)),a.drawImage(d.girlWalkFrames[g.frame],Math.floor(h+i),Math.floor(s)),a.restore(),a.fillStyle="white",a.font="16px monospace",a.fillText(`x: ${Math.floor(g.x)}`,10,20)})(),requestAnimationFrame(u)};(async()=>{const e=await f("tree-100-100.png"),t=await f("tree2-100-100.png"),a=await f("gate-32-64.png"),r=await f("girl-idle.png"),n=await f("girl-walk.png");d.skyImage=await f("sky-800-300.png"),d.mountainImage=await f("mountain-800-300.png"),d.groundImage=await f("ground-64-32.png"),d.girlIdleFrames=w(r,4),d.girlWalkFrames=w(n,6);const g={idle:{frames:d.girlIdleFrames,frame:0,duration:1e3},walk:{frames:d.girlWalkFrames,frame:0,duration:250}};o.push({type:0,x:-1e4,y:0,image:a,blocks:1},{type:0,x:-1200,y:0,image:e},{type:1,x:100,y:0,image:g,anim:"idle",direction:-1},{type:0,x:150,y:2,image:t,moveSpeed:.95},{type:0,x:200,y:0,image:e},{type:0,x:1400,y:0,image:e},{type:0,x:1e4,y:0,image:a,blocks:1}),addEventListener("keydown",s),addEventListener("keyup",l),i(),requestAnimationFrame(u)})().catch(console.error)})();