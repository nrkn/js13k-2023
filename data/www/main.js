(()=>{"use strict";const e=160,t={bg:{x:220,y:183,width:40,height:31},frames:[{shoulderBack:{x:12.5,y:15.5},elbowBack:{x:15.5,y:17.5},handBack:{x:13,y:20},hipBack:{x:11,y:24},kneeBack:{x:12.5,y:26.5},heelBack:{x:11.5,y:29.5},torso:{x:6,y:15,width:7,height:9},shoulderFront:{x:5.5,y:15.5},elbowFront:{x:1.5,y:17.5},handFront:{x:5,y:20},hipFront:{x:6,y:24},kneeFront:{x:4.5,y:25.5},heelFront:{x:4.5,y:29.5}},{shoulderBack:{x:12.5,y:16.5},elbowBack:{x:15.5,y:18.5},handBack:{x:13,y:21},hipBack:{x:11,y:25},kneeBack:{x:12.5,y:27.5},heelBack:{x:11.5,y:29.5},torso:{x:6,y:16,width:7,height:9},shoulderFront:{x:5.5,y:16.5},elbowFront:{x:1.5,y:18.5},handFront:{x:5,y:21},hipFront:{x:6,y:25},kneeFront:{x:4.5,y:26.5},heelFront:{x:4.5,y:29.5}}]},o={bg:{x:166,y:239,width:180,height:33},frames:[{shoulderBack:{x:11.5,y:18.5},elbowBack:{x:10.5,y:20.5},handBack:{x:8,y:23},hipBack:{x:12,y:25},kneeBack:{x:13.5,y:27.5},heelBack:{x:14.5,y:31.5},torso:{x:5,y:16,width:8,height:9},shoulderFront:{x:7.5,y:18.5},elbowFront:{x:8.5,y:20.5},handFront:{x:11,y:23},hipFront:{x:7,y:25},kneeFront:{x:5.5,y:27.5},heelFront:{x:2.5,y:31.5}},{shoulderBack:{x:10.5,y:19.5},elbowBack:{x:8.5,y:19.5},handBack:{x:6,y:21},hipBack:{x:11,y:26},kneeBack:{x:11.5,y:28.5},heelBack:{x:10.5,y:31.5},torso:{x:5,y:17,width:8,height:9},shoulderFront:{x:8.5,y:19.5},elbowFront:{x:9.5,y:20.5},handFront:{x:12,y:23},hipFront:{x:7,y:26},kneeFront:{x:5.5,y:27.5},heelFront:{x:1.5,y:27.5}},{shoulderBack:{x:6.5,y:18.5},elbowBack:{x:6.5,y:21.5},handBack:{x:10,y:23},hipBack:{x:9,y:25},kneeBack:{x:9.5,y:28.5},heelBack:{x:8.5,y:31.5},torso:{x:6,y:16,width:7,height:9},shoulderFront:{x:7.5,y:18.5},elbowFront:{x:9.5,y:20.5},handFront:{x:12,y:22},hipFront:{x:9,y:25},kneeFront:{x:10.5,y:27.5},heelFront:{x:5.5,y:27.5}},{shoulderBack:{x:11.5,y:17.5},elbowBack:{x:9.5,y:19.5},handBack:{x:13,y:20},hipBack:{x:8,y:25},kneeBack:{x:7.5,y:27.5},heelBack:{x:5.5,y:31.5},torso:{x:6,y:15,width:7,height:9},shoulderFront:{x:6.5,y:17.5},elbowFront:{x:6.5,y:19.5},handFront:{x:9,y:22},hipFront:{x:12,y:25},kneeFront:{x:11.5,y:26.5},heelFront:{x:9.5,y:27.5}},{shoulderBack:{x:10.5,y:16.5},elbowBack:{x:12.5,y:18.5},handBack:{x:13,y:21},hipBack:{x:8,y:25},kneeBack:{x:6.5,y:27.5},heelBack:{x:4.5,y:31.5},torso:{x:6,y:15,width:7,height:9},shoulderFront:{x:5.5,y:17.5},elbowFront:{x:5.5,y:19.5},handFront:{x:7,y:22},hipFront:{x:12,y:25},kneeFront:{x:12.5,y:26.5},heelFront:{x:13.5,y:29.5}},{shoulderBack:{x:12.5,y:17.5},elbowBack:{x:13.5,y:18.5},handBack:{x:14,y:21},hipBack:{x:8,y:26},kneeBack:{x:6.5,y:28.5},heelBack:{x:3.5,y:31.5},torso:{x:6,y:16,width:7,height:9},shoulderFront:{x:5.5,y:17.5},elbowFront:{x:4.5,y:19.5},handFront:{x:4,y:22},hipFront:{x:12,y:26},kneeFront:{x:12.5,y:28.5},heelFront:{x:13.5,y:31.5}},{shoulderBack:{x:11.5,y:18.5},elbowBack:{x:13.5,y:19.5},handBack:{x:15,y:22},hipBack:{x:8,y:28},kneeBack:{x:6.5,y:27.5},heelBack:{x:3.5,y:27.5},torso:{x:5,y:17,width:8,height:9},shoulderFront:{x:5.5,y:18.5},elbowFront:{x:3.5,y:19.5},handFront:{x:2,y:22},hipFront:{x:11,y:26},kneeFront:{x:10.5,y:28.5},heelFront:{x:10.5,y:31.5}},{shoulderBack:{x:12.5,y:17.5},elbowBack:{x:11.5,y:18.5},handBack:{x:14,y:21},hipBack:{x:11,y:26},kneeBack:{x:9.5,y:27.5},heelBack:{x:6.5,y:27.5},torso:{x:6,y:16,width:7,height:9},shoulderFront:{x:6.5,y:17.5},elbowFront:{x:4.5,y:19.5},handFront:{x:3,y:22},hipFront:{x:9,y:26},kneeFront:{x:8.5,y:28.5},heelFront:{x:8.5,y:31.5}},{shoulderBack:{x:10.5,y:17.5},elbowBack:{x:12.5,y:18.5},handBack:{x:13,y:21},hipBack:{x:12,y:24},kneeBack:{x:10.5,y:26.5},heelBack:{x:8.5,y:28.5},torso:{x:5,y:15,width:8,height:9},shoulderFront:{x:5.5,y:17.5},elbowFront:{x:4.5,y:19.5},handFront:{x:4,y:22},hipFront:{x:8,y:25},kneeFront:{x:7.5,y:28.5},heelFront:{x:6.5,y:31.5}},{shoulderBack:{x:11.5,y:17.5},elbowBack:{x:11.5,y:18.5},handBack:{x:12,y:21},hipBack:{x:12,y:24},kneeBack:{x:12.5,y:26.5},heelBack:{x:12.5,y:29.5},torso:{x:6,y:15,width:7,height:9},shoulderFront:{x:6.5,y:17.5},elbowFront:{x:5.5,y:19.5},handFront:{x:6,y:22},hipFront:{x:9,y:25},kneeFront:{x:7.5,y:28.5},heelFront:{x:5.5,y:31.5}}]},a=(e,t)=>({x:0|e,y:0|t}),h=(e,t,o,a,h,n)=>Math.abs(e*(a-n)+o*(n-t)+h*(t-a)),n=(e,t,o,a)=>h(t.x,t.y,o.x,o.y,a.x,a.y)===h(e.x,e.y,o.x,o.y,a.x,a.y)+h(t.x,t.y,e.x,e.y,a.x,a.y)+h(t.x,t.y,o.x,o.y,e.x,e.y),y=(e,t,o)=>{e=a(e.x,e.y),t=a(t.x,t.y),o=a(o.x,o.y);const h=[],y=Math.min(e.x,t.x,o.x),r=Math.max(e.x,t.x,o.x),i=Math.min(e.y,t.y,o.y),x=Math.max(e.y,t.y,o.y);for(let a=y;a<=r;a++)for(let y=i;y<=x;y++)n({x:a,y},e,t,o)&&h.push({x:0|a,y:0|y});return h},r=(e,t,o,a)=>[...y(e,t,o),...y(e,o,a)],i=(e,t,o,h)=>{e|=0,t|=0,h|=0;const n=[];for(let y=-(o|=0);y<=o;y++){const r=h*Math.sqrt(1-y*y/(o*o));for(let o=-r;o<=r;o++)n.push(a(e+y,t+o))}return n},x=(e,t,o)=>i(e,t,o,o),l=(e,t,o,h,n)=>{const y=(o|=0)-(e|=0),r=(h|=0)-(t|=0),i=Math.atan2(r,y),x=n/2,l=e+Math.cos(i-Math.PI/2)*x,c=t+Math.sin(i-Math.PI/2)*x,d=e+Math.cos(i+Math.PI/2)*x,s=t+Math.sin(i+Math.PI/2)*x,k=o+Math.cos(i+Math.PI/2)*x,g=h+Math.sin(i+Math.PI/2)*x,m=o+Math.cos(i-Math.PI/2)*x,w=h+Math.sin(i-Math.PI/2)*x;return[a(d,s),a(l,c),a(m,w),a(k,g)]},d="#002a60",s="#0043e6",k="#f2de00",g="#008a31",m=e=>{const{width:t,height:o}=e.bg,a=e.frames.length,h=t/a,n=[];for(let t=0;t<a;t++){const a=document.createElement("canvas");a.width=h,a.height=o;const y=a.getContext("2d"),i=e.frames[t],{shoulderBack:c,elbowBack:m,handBack:w,hipBack:F,kneeBack:p,heelBack:B,shoulderFront:f,elbowFront:u,handFront:b,hipFront:M,kneeFront:I,heelFront:v,torso:T}=i,S=(e,t,o,a)=>{const h=x(t.x,t.y,a),n=x(o.x,o.y,a),i=l(t.x,t.y,o.x,o.y,a),c=[...h,...n,...r(...i)];y.fillStyle=e;for(const{x:e,y:t}of c)y.fillRect(e,t,1,1)};S(d,c,m,2),S(d,m,w,2),S(g,F,p,2),S(g,p,B,2),y.fillStyle="red";const P=r({x:T.x,y:T.y},{x:T.x+T.width,y:T.y},{x:T.x+T.width,y:T.y+T.height},{x:T.x,y:T.y+T.height});for(const{x:e,y:t}of P)y.fillRect(e,t,1,1);S(s,f,u,2),S(s,u,b,2),S(k,M,I,2),S(k,I,v,2),n.push(a)}return{frames:n,frame:0,duration:1e3}},w=c;w.width=e,w.height=e;const F=w.getContext("2d"),p=(t=innerWidth,o=innerHeight)=>{const a=t>o?o/e:t/e;w.width=Math.floor(t/a),w.height=Math.floor(o/a)};addEventListener("resize",(()=>p()));const B={startTime:0,lastTime:0,elapsedTime:0,deltaTime:0},f=[],u=new Image,b=[],M={skyImage:u,mountainImage:u,groundImage:u,treeImage:u,girlIdleFrames:b,girlWalkFrames:b},I={type:2,x:0,y:0,image:void 0,anim:"idle",speed:0,acceleration:0,direction:1,intersects:1},v=e=>{"ArrowLeft"===e.key?(I.direction=-1,I.acceleration=.125):"ArrowRight"===e.key&&(I.direction=1,I.acceleration=-.125)},T=e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(I.acceleration=0)},S=e=>new Promise(((t,o)=>{const a=new Image;a.src=e,a.onload=()=>t(a),a.onerror=o})),P=e=>{let t;if(1===e.type||2===e.type){const o=e.image[e.anim];t=o.frames[o.frame]}else t=e.image;return t};let E=[];const R=e=>{B.startTime||(B.startTime=e,B.lastTime=e),B.elapsedTime=e-B.startTime,B.deltaTime=e-B.lastTime,B.lastTime=e,(e=>{(e=>{for(const e of f){if(1===e.type||2===e.type){const{elapsedTime:t}=B,o=e.image[e.anim],{duration:a,frames:h}=o,n=h.length,y=Math.floor(t/a*n)%n;o.frame=y}void 0!==e.speed&&void 0!==e.acceleration&&(e.speed+=e.acceleration,e.speed*=.95,e.x-=e.speed,Math.abs(e.speed)<.1?(e.speed=0,1!==e.type&&2!==e.type||(e.anim="idle")):1!==e.type&&2!==e.type||(e.anim="walk"))}})(),(()=>{E=[];for(let e=0;e<f.length;e++){const t=f[e];if(t.blocks||t.intersects)for(let o=0;o<f.length;o++){const a=f[o];if(e!==o&&(a.blocks||a.intersects)){const h=P(t),n=P(a),y=t.x,r=t.y,i=h.width,x=h.height,l=a.x,c=a.y,d=n.width,s=n.height;y<l+d&&y+i>l&&r<c+s&&r+x>c&&E.push([e,o])}}}})();for(let e=0;e<E.length;e++){const[t,o]=E[e],a=f[t];f[t].intersects&&f[o].blocks&&"number"==typeof a.speed&&(a.x+=a.speed,a.speed=0)}})(),(e=>{w.width=w.width;const t=w.width/2,o=w.height/2;for(const e of f){const a=P(e),h=e.moveSpeed?(1-e.moveSpeed)*I.x:0;let n,y=Math.floor(e.x+h-I.x-a.width/2+t);n=2===e.tiling?w.height-a.height:1===e.tiling?o-a.height/2+e.y:w.height-a.height-M.groundImage.height+e.y,2===e.type&&(y=t-a.width/2,n=w.height-a.height-M.groundImage.height);const r=(t,o)=>{F.save(),-1===e.direction?(F.translate(t+a.width,o),F.scale(-1,1),F.drawImage(a,0,0)):F.drawImage(a,t,o),F.restore()};if((e.tiling||y+a.width>0&&y<w.width)&&(r(y,n),e.tiling)){let e=y-a.width;for(;e+a.width>0;)r(e,n),e-=a.width;let t=y+a.width;for(;t<w.width;)r(t,n),t+=a.width}}F.fillStyle="white",F.font="12px monospace",F.fillText(`x: ${I.x.toFixed(2)}`,10,20),F.fillText(`speed: ${I.speed.toFixed(2)}`,10,40),F.fillText(`accel: ${I.acceleration.toFixed(2)}`,10,60)})(),requestAnimationFrame(R)};(async()=>{const e=m(o),a=m(t),h=await S("tree-100-100.png"),n=await S("tree2-100-100.png"),y=await S("gate-32-64.png");M.skyImage=((e=800,t=300,o=10,a="#33d5fe",h="#caebfb",n=20,y=40,r=10,x=20)=>{const l=document.createElement("canvas");l.width=e,l.height=t;const c=l.getContext("2d");c.fillStyle=a,c.fillRect(0,0,l.width,l.height);for(let e=0;e<o;e++){const e=Math.random()*l.width,t=Math.random()*l.height/2,o=3+Math.floor(3*Math.random());for(let a=0;a<o;a++){const o=n+Math.random()*y,a=r+Math.random()*x,d=(Math.random()-.5)*y,s=(Math.random()-.5)*x,k=i(e+d,t+s,o,a);c.fillStyle=h,k.forEach((({x:e,y:t})=>{e=(e+l.width)%l.width,t=(t+l.height)%l.height,c.fillRect(e,t,1,1)}))}}return l})(800,300),M.mountainImage=((e=800,t=300,o="#a4b1bd",a="#628099",h="#1f65a1",n=.5,y=.4,i=.3)=>{const x=document.createElement("canvas");x.width=e,x.height=t;const l=x.getContext("2d"),c=(o,a,h)=>{const n=t*a;let y=n+(Math.random()*h-h/2);for(let i=1;i<e;i++){let e=Math.random()*h-h/2;y>n+a*t-h&&(e=-1*Math.abs(e));let c=y+e;c=Math.min(n+a*t,c),c=Math.max(.1*t,c);const d=r({x:i-1,y:t-y},{x:i,y:t-c},{x:i,y:t},{x:i-1,y:t});l.fillStyle=o,d.forEach((({x:e,y:t})=>{e=(e+x.width)%x.width,t=(t+x.height)%x.height,l.fillRect(e,t,1,1)})),y=c}};return c(o,n,15),c(a,y,10),c(h,i,5),x})(800,300),M.groundImage=await S("ground-64-32.png");const x={idle:a,walk:e};I.image=x,f.push({type:0,x:0,y:0,image:M.skyImage,moveSpeed:.5,tiling:1},{type:0,x:0,y:0,image:M.mountainImage,moveSpeed:.8,tiling:1},{type:0,x:-2500,y:0,image:y,blocks:1},{type:0,x:-1200,y:0,image:h},{type:1,x:100,y:0,image:x,anim:"idle",direction:-1},{type:0,x:150,y:2,image:n,moveSpeed:.95},{type:0,x:200,y:0,image:h},{type:0,x:1400,y:0,image:h},{type:0,x:2500,y:0,image:y,blocks:1},{type:0,x:0,y:0,image:M.groundImage,moveSpeed:1,tiling:2},I),addEventListener("keydown",v),addEventListener("keyup",T),p(),requestAnimationFrame(R)})().catch(console.error)})();