(()=>{"use strict";const t=160,e=[[40,31],[[5,15,1,17,5,20,12,15,15,17,13,20,6,24,4,25,4,29,11,24,12,26,11,29],[5,16,1,18,5,21,12,16,15,18,13,21,6,25,4,26,4,29,11,25,12,27,11,29]]],o=[[180,33],[[7,18,8,20,11,23,11,18,10,20,8,23,7,25,5,27,2,31,12,25,13,27,14,31],[8,19,9,20,12,23,10,19,8,19,6,21,7,26,5,27,1,27,11,26,11,28,10,31],[7,18,9,20,12,22,6,18,6,21,10,23,9,25,10,27,5,27,11,25,12,27,11,31],[5,17,6,19,9,22,11,17,13,19,14,21,12,25,11,26,9,27,8,25,6,27,4,31],[4,17,5,19,7,22,10,17,12,18,13,21,12,26,12,28,13,31,8,26,6,28,3,31],[5,17,4,19,4,22,12,17,13,18,14,21,12,26,12,28,13,31,8,26,6,28,3,31],[5,18,3,19,2,22,11,18,13,19,15,22,11,26,10,28,10,31,8,28,6,27,3,27],[6,17,4,19,3,22,11,17,11,18,12,21,9,26,8,28,8,31,8,26,6,27,3,27],[5,17,4,19,4,22,11,17,11,18,12,21,8,25,7,28,6,31,12,25,13,27,14,31],[6,17,5,19,6,22,11,17,11,18,12,21,7,25,7,28,5,31,12,24,10,26,8,28]]],n=(t,e)=>({x:Math.round(t),y:Math.round(e)}),a=(t,e,o,n,a,i)=>Math.abs(t*(n-i)+o*(i-e)+a*(e-n)),i=(t,e,o,n)=>a(e.x,e.y,o.x,o.y,n.x,n.y)===a(t.x,t.y,o.x,o.y,n.x,n.y)+a(e.x,e.y,t.x,t.y,n.x,n.y)+a(e.x,e.y,o.x,o.y,t.x,t.y),r=(t,e,o)=>{t=n(t.x,t.y),e=n(e.x,e.y),o=n(o.x,o.y);const a=[],r=Math.min(t.x,e.x,o.x),h=Math.max(t.x,e.x,o.x),s=Math.min(t.y,e.y,o.y),l=Math.max(t.y,e.y,o.y);for(let n=r;n<=h;n++)for(let r=s;r<=l;r++)i({x:n,y:r},t,e,o)&&a.push({x:0|n,y:0|r});return a},h=(t,e,o,n)=>[...r(t,e,o),...r(t,o,n)],s=[...Array(256)].map(((t,e)=>e));s.sort((()=>Math.random()-.5)),s.push(...s);const l=(t,e,o,a)=>{t|=0,e|=0,a|=0;const i=[];for(let r=-(o|=0);r<=o;r++){const h=a*Math.sqrt(1-r*r/(o*o));for(let o=-h;o<=h;o++)i.push(n(t+r,e+o))}return i},d=c;d.width=t,d.height=t;const f=d.getContext("2d"),y=(e=innerWidth,o=innerHeight)=>{const n=e>o?o/t:e/t;d.width=Math.floor(e/n),d.height=Math.floor(o/n)};addEventListener("resize",(()=>y()));const x={startTime:0,lastTime:0,elapsedTime:0,deltaTime:0},m=[],M={type:2,x:0,y:0,image:void 0,anim:"idle",speed:0,acceleration:0,direction:1,intersects:1},g=t=>{"ArrowLeft"===t.key?(M.direction=-1,M.acceleration=.175):"ArrowRight"===t.key&&(M.direction=1,M.acceleration=-.175)},p=t=>{"ArrowLeft"!==t.key&&"ArrowRight"!==t.key||(M.acceleration=0)},u=t=>{let e;if(1===t.type||2===t.type){const o=t.image[t.anim];e=o.frames[o.frame]}else e=t.image;return e};let w=[];const b=t=>{x.startTime||(x.startTime=t,x.lastTime=t),x.elapsedTime=t-x.startTime,x.deltaTime=t-x.lastTime,x.lastTime=t,(t=>{(t=>{for(const t of m){if(1===t.type||2===t.type){const{elapsedTime:e}=x,o=t.image[t.anim],{duration:n,frames:a}=o,i=a.length,r=Math.floor(e/n*i)%i;o.frame=r}void 0!==t.speed&&void 0!==t.acceleration&&(t.speed+=t.acceleration,t.speed*=.95,t.x-=t.speed,Math.abs(t.speed)<.1?(t.speed=0,1!==t.type&&2!==t.type||(t.anim="idle")):1!==t.type&&2!==t.type||(t.anim="walk"))}})(),(()=>{w=[];for(let t=0;t<m.length;t++){const e=m[t];if(e.blocks||e.intersects)for(let o=0;o<m.length;o++){const n=m[o];if(t!==o&&(n.blocks||n.intersects)){const a=u(e),i=u(n),r=e.x,h=e.y,s=a.width,l=a.height,c=n.x,d=n.y,f=i.width,y=i.height;r<c+f&&r+s>c&&h<d+y&&h+l>d&&w.push([t,o])}}}})();for(let t=0;t<w.length;t++){const[e,o]=w[t],n=m[e];m[e].intersects&&m[o].blocks&&"number"==typeof n.speed&&(n.x+=n.speed,n.speed=0)}})(),(t=>{d.width=d.width;const e=d.width/2,o=d.height/2;for(const t of m){const n=u(t),a=t.moveSpeed?(1-t.moveSpeed)*M.x:0;let i,r=Math.floor(t.x+a-M.x-n.width/2+e);i=2===t.tiling?d.height-n.height:1===t.tiling?o-n.height/2+t.y:d.height-n.height-16+t.y,2===t.type&&(r=e-n.width/2,i=d.height-n.height-16);const h=(e,o)=>{f.save(),-1===t.direction?(f.translate(e+n.width,o),f.scale(-1,1),f.drawImage(n,0,0)):f.drawImage(n,e,o),f.restore()};if((t.tiling||r+n.width>0&&r<d.width)&&(h(r,i),t.tiling)){let t=r-n.width;for(;t+n.width>0;)h(t,i),t-=n.width;let e=r+n.width;for(;e<d.width;)h(e,i),e+=n.width}}f.fillStyle="white",f.font="12px monospace",f.fillText(`x: ${M.x.toFixed(2)}`,10,20),f.fillText(`speed: ${M.speed.toFixed(2)}`,10,40),f.fillText(`accel: ${M.acceleration.toFixed(2)}`,10,60)})(),requestAnimationFrame(b)},S=(t,e,o,a,i)=>{const r=(o|=0)-(t|=0),h=(a|=0)-(e|=0),s=Math.atan2(h,r),l=i/2,c=t+Math.cos(s-Math.PI/2)*l,d=e+Math.sin(s-Math.PI/2)*l,f=t+Math.cos(s+Math.PI/2)*l,y=e+Math.sin(s+Math.PI/2)*l,x=o+Math.cos(s+Math.PI/2)*l,m=a+Math.sin(s+Math.PI/2)*l,M=o+Math.cos(s-Math.PI/2)*l,g=a+Math.sin(s-Math.PI/2)*l;return[n(f,y),n(c,d),n(M,g),n(x,m)]},v=(t=100,e=100,o="#2e6d35",n="#5b3138")=>{const a=3*Math.random()+5,i=document.createElement("canvas");i.width=t,i.height=e;const r=i.getContext("2d"),s=Math.floor(t/15),c=Math.floor(e/2),d=h({x:(t-s)/2,y:e-c},{x:(t+s)/2,y:e-c},{x:(t+s)/2,y:e},{x:(t-s)/2,y:e});r.fillStyle=n;for(const t of d)r.fillRect(t.x,t.y,1,1);const f=Math.floor(3*s/4),y=Math.floor(e/4);for(let i=0;i<a;i++){const a=Math.random()*Math.PI/2-Math.PI/4+Math.PI/2,i=t/2,s=e-c,d=i+y*Math.cos(a),x=s-y*Math.sin(a),m=S(i,s,d,x,f),M=h(...m);r.fillStyle=n;for(const t of M)r.fillRect(t.x,t.y,1,1);const g=l(d,x,2*f,f);r.fillStyle=o;for(const t of g)r.fillRect(t.x,t.y,1,1)}return i},T=[];T[0]="#ff0000",T[1]="#ff7f00",T[2]="#ffff00",T[3]="#8b0000",T[4]="#8b4500",T[5]="#8b8b00",T[6]="#00ff00",T[7]="#0000ff",T[8]="#8a2be2",T[9]="#006400",T[10]="#00008b",T[11]="#551a8b";const I=t=>{const e=parseInt(t.slice(1),16);return[e>>16,e>>8&255,255&e]},R=(t,e)=>{const o=document.createElement("canvas");return o.width=t,o.height=e,o},k=(t,e,o,n,a,i)=>{const r=((t,e,o,n)=>{t|=0,e|=0,o|=0,n|=0;const a=[],i=Math.abs(o-t),r=Math.abs(n-e),h=t<o?1:-1,s=e<n?1:-1;let l=i-r;for(;a.push({x:t,y:e}),t!==o||e!==n;){const o=2*l;o>-r&&(l-=r,t+=h),o<i&&(l+=i,e+=s)}return a})(o,n,a,i);return{points:r,mid:((t,e,o=.5)=>{const n=((t,e,o=.5)=>{const[n,a,i]=t,[r,h,s]=e;return[Math.round(n+(r-n)*o),Math.round(a+(h-a)*o),Math.round(i+(s-i)*o)]})(I(t),I(e),o);return(t=>{const[e,o,n]=t;return`#${e.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`})(n)})(t,e)}},E=(t,e,o)=>{const n=t[2*e],a=t[2*e+1],i=t[2*o],r=t[2*o+1],h=T[e],s=T[o];return k(h,s,n,a,i,r)},P=(t,e)=>{t.fillStyle=e.mid;for(const{x:o,y:n}of e.points)t.fillRect(o,n,1,1)},C=(t,e)=>{const o=T.length;for(let n=0;n<o;n++){const o=T[n],a=e[2*n],i=e[2*n+1];t.fillStyle=o,t.fillRect(a,i,1,1)}},A=(t,e,o,n,a)=>{n&&((t,e)=>{P(t,E(e,3,4)),P(t,E(e,4,5)),P(t,E(e,9,10)),P(t,E(e,10,11))})(t,e),o&&((t,e,o)=>{const n=((t,e)=>{const o=E(t,0,3),n=E(t,6,9),a=(t[0]+t[6])/2,i=(t[1]+t[7])/2,r=(t[12]+t[18])/2,h=(t[13]+t[19])/2,s=k(o.mid,n.mid,a,i,r,h);return[o,n,s,k(o.mid,s.mid,a,i,a,i-e)]})(e,o);for(const e of n)P(t,e)})(t,e,4),a&&((t,e)=>{P(t,E(e,0,1)),P(t,E(e,1,2)),P(t,E(e,6,7)),P(t,E(e,7,8))})(t,e)},$=(t,e=!0,o=!0,n=!0,a=!0,i=!0)=>{const r=t[0],h=t[1],[s,l]=r,c=h.length,d=s/c,f=[];for(let t=0;t<c;t++){const r=R(d,l),s=r.getContext("2d"),c=h[t];e&&A(s,c,n,a,i),o&&C(s,c),f.push(r)}return{frames:f,frame:0,duration:1e3}};(async()=>{const t=$(o),n=$(e),a=v(100,100),i=v(100,100,"#225027","#422429"),s=((t=32,e=64,o=4,n=2,a="#333333")=>{const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d"),l=[],c=Math.floor(t/o);for(let t=0;t<o;t++){let o=t*c+c/2,n=o,a=0,i=e;o+=5*Math.random()-3,n+=5*Math.random()-3,a+=3*Math.random(),l.push({x1:o,y1:a,x2:o,y2:i})}const d=[],f=Math.floor(e/n);for(let e=0;e<n;e++){let o=0,n=t,a=e*f+f/2,i=a;o+=3*Math.random(),n-=3*Math.random(),a+=5*Math.random()-3,i+=5*Math.random()-3,d.push({x1:o,y1:a,x2:n,y2:i})}const y=t=>{const e=S(t.x1,t.y1,t.x2,t.y2,2),o=h(...e);for(const{x:t,y:e}of o)s.fillRect(t,e,1,1)};s.fillStyle=a;for(const t of l){y(t);const e=r({x:t.x1-4,y:t.y1-8},{x:t.x1+4,y:t.y1-8},{x:t.x1,y:t.y1});for(const{x:t,y:o}of e)s.fillRect(t,o,1,1)}for(const t of d)y(t);return i})(32,64),c=((t=800,e=300,o=10,n="#33d5fe",a="#caebfb",i=20,r=40,h=10,s=20)=>{const c=document.createElement("canvas");c.width=t,c.height=e;const d=c.getContext("2d");d.fillStyle=n,d.fillRect(0,0,c.width,c.height);for(let t=0;t<o;t++){const t=Math.random()*c.width,e=Math.random()*c.height/2,o=3+Math.floor(3*Math.random());for(let n=0;n<o;n++){const o=i+Math.random()*r,n=h+Math.random()*s,f=(Math.random()-.5)*r,y=(Math.random()-.5)*s,x=l(t+f,e+y,o,n);d.fillStyle=a,x.forEach((({x:t,y:e})=>{t=(t+c.width)%c.width,e=(e+c.height)%c.height,d.fillRect(t,e,1,1)}))}}return c})(800,300),d=((t=800,e=300,o="#a4b1bd",n="#628099",a="#1f65a1",i=.5,r=.4,s=.3)=>{const l=document.createElement("canvas");l.width=t,l.height=e;const c=l.getContext("2d"),d=(o,n,a)=>{const i=e*n;let r=i+(Math.random()*a-a/2);for(let s=1;s<t;s++){let t=Math.random()*a-a/2;r>i+n*e-a&&(t=-1*Math.abs(t));let d=r+t;d=Math.min(i+n*e,d),d=Math.max(.1*e,d);const f=h({x:s-1,y:e-r},{x:s,y:e-d},{x:s,y:e},{x:s-1,y:e});c.fillStyle=o,f.forEach((({x:t,y:e})=>{t=(t+l.width)%l.width,e=(e+l.height)%l.height,c.fillRect(t,e,1,1)})),r=d}};return d(o,i,15),d(n,r,10),d(a,s,5),l})(800,300),f=((t=64,e=16,o=8,n="#4f942d",a="#874718")=>{const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d"),l=Math.floor(e/3),c=Math.floor(2*e/3),d=Math.floor(t/o),f=h({x:0,y:0},{x:t-1,y:0},{x:t-1,y:e-1},{x:0,y:e-1});s.fillStyle=a;for(const t of f)s.fillRect(t.x,t.y,1,1);const y=h({x:0,y:0},{x:t-1,y:0},{x:t-1,y:l},{x:0,y:l});s.fillStyle=n;for(const t of y)s.fillRect(t.x,t.y,1,1);for(let t=0;t<o;t++){const e=t*d,o=r({x:e,y:l},{x:e+d-1,y:l},{x:e+d/2,y:c});for(const t of o)s.fillRect(t.x,t.y,1,1)}return i})(64,16),x={idle:n,walk:t},u=(t=>{let e=0,o=0;for(const n of t)e+=n.width,o=Math.max(o,n.height);const n=document.createElement("canvas");n.width=e,n.height=o;const a=n.getContext("2d");let i=0;for(const e of t)a.drawImage(e,i,0),i+=e.width;return n})(t.frames);document.body.append(u),M.image=x,m.push({type:0,x:0,y:0,image:c,moveSpeed:.5,tiling:1},{type:0,x:0,y:0,image:d,moveSpeed:.8,tiling:1},{type:0,x:-500,y:0,image:s,blocks:1},{type:0,x:-200,y:0,image:a},{type:1,x:100,y:0,image:x,anim:"idle",direction:-1},{type:0,x:150,y:2,image:i,moveSpeed:.95},{type:0,x:200,y:0,image:a},{type:0,x:500,y:0,image:a},{type:0,x:800,y:0,image:s,blocks:1},{type:0,x:0,y:0,image:f,moveSpeed:1,tiling:2},M),addEventListener("keydown",g),addEventListener("keyup",p),y(),requestAnimationFrame(b)})().catch(console.error)})();